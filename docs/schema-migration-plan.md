# Database Migration Strategy Proposal

To maintain a reproducible and auditable schema for `mi_diario`, introduce Flyway-based migrations:

1. **Add Flyway dependency**
   - Include `org.flywaydb:flyway-core` in `pom.xml`.
   - Keep MariaDB4j dependency to offer a local embedded database.

2. **Baseline script**
   - Capture the schema generated by Hibernate into `src/main/resources/db/migration/V1__baseline.sql`.
   - Use `mysqldump --no-data` (or an equivalent JDBC export script) against the embedded MariaDB instance to produce the baseline SQL.

3. **Future changes**
   - For each schema change, create an incremental migration: `V2__add_notifications.sql`, `V3__add_indexes.sql`, etc.
   - Disable `spring.jpa.hibernate.ddl-auto` in production profiles to ensure Flyway controls the schema.

4. **Local developer workflow**
   - Start the application once so MariaDB4j boots and Flyway applies migrations automatically.
   - Optionally expose a Maven profile that runs `mvn flyway:migrate` independently for CI checks.

5. **CI/CD integration**
   - Add a pipeline job that executes `mvn -Pci flyway:validate` before running tests to guarantee that migrations are in sync with the entity model.

This approach keeps schema evolution deterministic while still supporting rapid local development with the embedded MariaDB instance.
